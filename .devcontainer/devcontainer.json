{
  "name": "n8n-codespace",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:20",

  "forwardPorts": [5678],
  "portsAttributes": {
    "5678": {
      "label": "n8n",
      "protocol": "https",
      "onAutoForward": "openPreview"
    }
  },

  // Garante que exista um "node" em ~/.vscode-remote/bin/* (evita o balão do terminal)
  "onCreateCommand": "mkdir -p ~/.vscode-remote/bin/fallback && ln -sf $(which node) ~/.vscode-remote/bin/fallback/node",

  // Dependências do ambiente
  "postCreateCommand": "sudo apt-get update && sudo apt-get install -y procps && npm config set fund false audit false && sudo npm i -g n8n@1.106.3",

  // Sobe o n8n quando o container inicia
  "postStartCommand": "bash .devcontainer/start-n8n.sh",

  // Cinto e suspensório contra o aviso do node
  "postAttachCommand": "bash -lc 'ls ~/.vscode-remote/bin/*/node >/dev/null 2>&1 || (mkdir -p ~/.vscode-remote/bin/fallback && ln -sf $(which node) ~/.vscode-remote/bin/fallback/node)'"
}
